<!doctype html>
<html lang="en">
{% include 'base/head.html' %}
<style>
    .pagination {
        margin: 40px 20px 70px 0;
        float: right;
    }

    table tr {
        text-align: center;
    }

    table td {
        text-align: center;
    }

    .page-link {
        color: #6c757d;
    }
</style>
<body>
{% include 'base/sentence_navbar.html' %}
<div class="container">
    <div style="padding: 20px 0;">
        <h3>Documents</h3>
        Type:
        <a href="/"><button type="button" class="btn {% if type == 'v1' %} btn-primary {% endif %}">v1</button></a>
        <a href="/v2"><button type="button" class="btn {% if type == 'v2' %} btn-primary {% endif %}">v2</button></a>
        <a href="/v3"><button type="button" class="btn {% if type == 'v3' %} btn-primary {% endif %}">v3</button></a>
    </div>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th>text</th>
            <th>writer</th>
            <th>reactions</th>
        </tr>
        </thead>
        <tbody>
        {% for sent in sents %}
        <tr>
            <td>
                <a href="/view_sent/{{sent.id}}">
                    {{sent['depth']}}
                </a>
            </td>
            <td>
                <a href="/view_sent/{{sent.id}}">
                    {{sent['text']}}
                </a>
            </td>
            <td>
                <a href="/view_user/{{sent.user}}">
                    {{sent['user']}}
                </a>
            </td>
            <td>
                <a>
                    123
                </a>
            
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item">
                <a class="page-link" href="javascript:go('1')">First</a>
            </li>
            {% for i in range(pagination['left'], pagination['right'] +1) %}
            <li class="page-item {% if pagination['page'] == i %} active {% endif %}">
                <a class="page-link" href="javascript:go('{{i}}')">{{i}}</a>
            </li>
            {% endfor %}
            <li class="page-item">
                <a class="page-link" href="javascript:go('{{pagination.total_page}}')">Last</a>
            </li>
            <div class="input-group mb-3 ml-3">
                <input type="text" class="form-control" placeholder="Page number" id="page-number" aria-label=""
                       aria-describedby="button-addon">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" id="page-number-button-addon">Go</button>
                </div>
            </div>
        </ul>
    </nav>
    <br /><br /><br />
    <form>    
      <div class="form-group">
        <label for="exampleFormControlTextarea1">Come up with a new starting sentence!</label>
        <textarea class="form-control" id="storyForm" rows="2"></textarea>
      </div>    
      <button type="submit" class="btn btn-primary" id="submit-btn">Submit</button>
    </form>
</div>
    

    
{% include 'base/script.html' %}

<script>
  function go(page_number) {
    location.assign(location.pathname + '?p=' + page_number);
  }

  $(document).ready(function () {
    for (let i = 0; i <= localStorage.length - 1; i++) {
      let key = localStorage.key(i);
      $('#' + key).html('<i class="fas fa-check"></i>');
    }

    $('#page-number-button-addon').click(function () {
      let page_number = $('#page-number').val();
      if (!page_number) page_number = 1;
      go(page_number)
    })
  });
  
  $('#submit-btn').click(function () {
    var text = $('#storyForm').val().trim();
    
    if (!text) {
      swal({
        title: '',
        text: 'Please enter the text.',
        type: 'error',
      });
      return;
    }

    $(this).hide();
    $.ajax({
      url: '/api/sentence/upload',
      contentType: 'application/json',
      type: 'POST',
      data: JSON.stringify({
        text: text,
        is_root: true
      }),
    }).done(function (data) {
      var doc = JSON.parse(data);
      localStorage.setItem(doc_type + '_' + doc.doc_id, data);
      location.assign('/mturk/doc/' + doc.doc_id + '/v2');
    }).fail(function () {
      $(this).show();
      swal({
        title: '',
        text: 'Error occurred. Please contact the administrator.',
        type: 'error',
      });
    })
  })
</script>
</body>
</html>
